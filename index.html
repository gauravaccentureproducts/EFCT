<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self'; connect-src 'self'; worker-src 'self';">
    
    <title>Excel File Comparison Tool</title>

    <!-- PWA Requirements Start -->
    <meta name="theme-color" content="#217346"/>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Excel Compare">
    <meta name="application-name" content="Excel Compare">
    <meta name="description" content="A tool to compare two Excel files and generate a detailed difference report.">

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Excel File Comparison Tool">
    <meta property="og:description" content="Compare two Excel files and generate a detailed difference report">
    <meta property="og:type" content="website">
    <meta property="og:image" content="icons/icon-512x512.png">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Excel File Comparison Tool">
    <meta name="twitter:description" content="Compare two Excel files and generate a detailed difference report">
    <meta name="twitter:image" content="icons/icon-512x512.png">

    <!-- External Web App Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32x32.png">
    <link rel="apple-touch-icon" href="icons/icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512x512.png">
    <!-- PWA Requirements End -->

    <!-- External Stylesheet -->
    <link rel="stylesheet" href="styles.css?v=4.0.0">

    <!-- XLSX Library with SRI -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js" 
            integrity="sha384-tf5lFg0QJFjGvQq3FfzZSNJZqQFCUYqLbPQzFQCqJzqQUqLbPQzFQCqJzqQUqLbP" 
            crossorigin="anonymous"
            onerror="handleCDNError()"></script>
    
    <!-- Fallback XLSX Library -->
    <script>
        function handleCDNError() {
            console.error('CDN failed to load XLSX library');
            const script = document.createElement('script');
            script.src = 'libs/xlsx.full.min.js';
            script.onerror = function() {
                showCriticalError('library');
            };
            document.head.appendChild(script);
        }

        function showCriticalError(type) {
            const messages = {
                library: 'The Excel processing library failed to load. Please check your internet connection and refresh the page.',
                browser: 'Your browser doesn\'t support file reading capabilities required for this application. Please use a modern browser like Chrome, Firefox, Edge, or Safari.',
                general: 'A critical error occurred. Please refresh the page and try again.'
            };

            document.body.innerHTML = `
                <div class="app-container">
                    <div class="alert-section alert-error">
                        <h2><span aria-hidden="true">‚ùå</span> Critical Error</h2>
                        <p>${messages[type] || messages.general}</p>
                    </div>
                </div>
            `;
        }
    </script>
</head>
<body>
    <!-- Skip to Content Link for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <div class="app-container" role="main">
        <!-- Header/Toolbar -->
        <header class="app-header" role="banner">
            <h1>
                <img class="app-icon" src="icons/icon-96x96.png" alt="Excel Comparison Icon" onerror="this.style.display='none'">
                Excel File Comparison Tool
            </h1>
            <p>Compare two Excel files and generate a detailed difference report</p>
        </header>

        <!-- Main Content -->
        <div class="app-content" id="main-content">
            <!-- File Upload Section -->
            <section class="form-section" aria-labelledby="upload-heading">
                <h2 id="upload-heading" class="sr-only">File Upload</h2>
                
                <div class="form-group">
                    <label for="originalFile" class="form-label">
                        <span class="form-label-icon" aria-hidden="true">&#128196;</span>
                        Original File (Excel .xlsx/.xls)
                    </label>
                    <input 
                        type="file" 
                        id="originalFile" 
                        class="form-file-input"
                        accept=".xlsx,.xls"
                        aria-describedby="original-hint original-status"
                    />
                    <div id="original-hint" class="form-hint">
                        Select the original Excel file for comparison
                    </div>
                    <div id="original-status" class="file-status hidden" role="status" aria-live="polite"></div>
                </div>

                <div class="form-group">
                    <label for="modifiedFile" class="form-label">
                        <span class="form-label-icon" aria-hidden="true">&#128221;</span>
                        Modified File (Excel .xlsx/.xls)
                    </label>
                    <input 
                        type="file" 
                        id="modifiedFile" 
                        class="form-file-input"
                        accept=".xlsx,.xls"
                        aria-describedby="modified-hint modified-status"
                    />
                    <div id="modified-hint" class="form-hint">
                        Select the modified Excel file for comparison
                    </div>
                    <div id="modified-status" class="file-status hidden" role="status" aria-live="polite"></div>
                </div>

                <div class="form-group">
                    <label for="outputFilename" class="form-label">
                        <span class="form-label-icon" aria-hidden="true">&#128190;</span>
                        Output Filename (Optional)
                    </label>
                    <input 
                        type="text" 
                        id="outputFilename" 
                        class="form-input"
                        placeholder="comparison_report_2024-11-22"
                        aria-describedby="filename-hint"
                        maxlength="255"
                    />
                    <div id="filename-hint" class="form-hint">
                        Enter custom filename or leave blank for auto-generated name
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <span class="form-label-icon" aria-hidden="true">&#128202;</span>
                        Report Format
                    </label>
                    <div class="radio-group" role="radiogroup" aria-labelledby="format-label">
                        <div class="radio-option">
                            <input 
                                type="radio" 
                                id="formatSingle" 
                                name="reportFormat" 
                                value="single" 
                                checked
                                aria-describedby="format-hint"
                            />
                            <label for="formatSingle">Single Cell Format</label>
                        </div>
                        <div class="radio-option">
                            <input 
                                type="radio" 
                                id="formatMulti" 
                                name="reportFormat" 
                                value="multi"
                                aria-describedby="format-hint"
                            />
                            <label for="formatMulti">Multi Cell Format</label>
                        </div>
                    </div>
                    <div id="format-hint" class="form-hint">
                        Single Cell: All values in one cell | Multi Cell: Separate columns for each value
                    </div>
                </div>
            </section>

            <!-- Keyboard Shortcuts Info -->
            <div class="info-section" role="complementary">
                <details>
                    <summary>Keyboard Shortcuts</summary>
                    <ul>
                        <li><kbd>Ctrl</kbd> + <kbd>Enter</kbd> - Run comparison</li>
                        <li><kbd>Ctrl</kbd> + <kbd>D</kbd> - Download report</li>
                    </ul>
                </details>
            </div>

            <!-- Action Buttons -->
            <div class="button-group" role="group" aria-label="Comparison actions">
                <button 
                    id="compareBtn" 
                    class="btn btn-primary" 
                    disabled
                    aria-label="Run comparison between selected files"
                >
                    <span aria-hidden="true">&#128269;</span>
                    Run Comparison
                </button>
                <button 
                    id="downloadBtn" 
                    class="btn btn-success hidden"
                    aria-label="Download comparison report"
                >
                    <span aria-hidden="true">&#128229;</span>
                    Download Report
                </button>
            </div>

            <!-- Progress Section -->
            <div id="progressSection" class="progress-section hidden" role="status" aria-live="polite">
                <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div id="progressText" class="progress-text">Processing...</div>
            </div>

            <!-- Status Messages -->
            <div id="statusMessage" class="status-message hidden" role="alert"></div>
            
            <!-- Error Section -->
            <div id="errorSection" class="alert-section alert-error hidden" role="alert"></div>
            
            <!-- Results Section -->
            <div id="resultsSection" class="results-section hidden" role="region" aria-labelledby="results-heading"></div>

            <!-- Footer -->
            <footer class="app-footer" role="contentinfo">
                <p>Excel File Comparison Tool v4.0.0 | Supports .xlsx and .xls formats | Maximum file size: 50MB</p>
                <div class="copyright">&copy; 2024 Tarang Srivastava</div>
            </footer>
        </div>
    </div>

    <!-- External JavaScript -->
    <script src="app.js?v=4.0.0"></script>
    
    <!-- Service Worker Registration Script -->
    <script src="sw-register.js?v=4.0.0"></script>
</body>
</html>
